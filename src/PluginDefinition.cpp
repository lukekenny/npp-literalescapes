//this file is part of notepad++
//Copyright (C)2021 Don HO <donho@altern.org>
//
//This program is free software: you can redistribute it and/or modify
//it under the terms of the GNU General Public License as published by
//the Free Software Foundation, either version 3 of the License, or
//(at your option) any later version.
//
//This program is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
//GNU General Public License for more details.
//
//You should have received a copy of the GNU General Public License
//along with this program.  If not, see <https://www.gnu.org/licenses/>.

#include "PluginDefinition.h"

// The plugin template expects these globals
NppData nppData;
FuncItem funcItem[nbFunc];

HINSTANCE g_hInstance = nullptr;

extern void decodeEscapesCommand();

// plugin name
const TCHAR NPP_PLUGIN_NAME[] = TEXT("LiteralEscapes");

// The data of Notepad++ that you can use in your plugin command
// in case of need.
void setInfo(NppData notepadPlusData)
{
	nppData = notepadPlusData;
}

const TCHAR* getName()
{
	return NPP_PLUGIN_NAME;
}

FuncItem* getFuncsArray(int* nbF)
{
	*nbF = nbFunc;
	return funcItem;
}

void beNotified(SCNotification* /*notifyCode*/)
{
	// no-op
}

LRESULT messageProc(UINT /*Message*/, WPARAM /*wParam*/, LPARAM /*lParam*/)
{
	return TRUE;
}

#ifdef UNICODE
BOOL isUnicode()
{
	return TRUE;
}
#endif //UNICODE

void pluginInit(HANDLE /*hModule*/)
{
	// no-op
}

void pluginCleanUp()
{
	// no-op
}

void commandMenuInit()
{
	setCommand(0, TEXT("Decode literal escapes (\\n or \\\\n -> LF)"), decodeEscapesCommand, nullptr, false);
}

void commandMenuCleanUp()
{
	// no-op
}

BOOL APIENTRY DllMain(HINSTANCE hInst, DWORD reason, LPVOID /*lpReserved*/)
{
	switch (reason)
	{
		case DLL_PROCESS_ATTACH:
			g_hInstance = hInst;
			pluginInit(hInst);
			break;

		case DLL_PROCESS_DETACH:
			pluginCleanUp();
			break;

		case DLL_THREAD_ATTACH:
		case DLL_THREAD_DETACH:
			break;
	}
	return TRUE;
}
